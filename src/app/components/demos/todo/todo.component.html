<div class="date-container">
  <span class="today">今天</span>
  <span class="today-time">
    <!-- I hate this format, but I don't know how to show the day with suffix -->
    {{today | date: 'EE MMMMd日'}}
  </span>
  <div class="form-container">
    <div class="add-task" *ngIf="!showAddForm">
      <span class="add-task-btn" (click)="showTaskForm(true)">
        <i nz-icon nzType="plus" nzTheme="outline"></i>新增任務
      </span>
    </div>

    <div class="add-form" *ngIf="showAddForm" [formGroup]="createForm">
      <div>
        <form nz-form [formGroup]="createForm">
          <nz-form-item>
            <nz-form-control>
              <nz-input-group nzCompact>
                <input class="form-name" type="text" nz-input placeholder="例如：今天七點前更新鐵人賽文章" formControlName="name"/>
                <nz-date-picker
                  formControlName="deadline"
                  nzFormat="MMMMd日 HH:mm"
                  [nzShowTime]="{ nzFormat: 'HH:mm' }"
                  [nzDisabledDate]="disabledDate"
                ></nz-date-picker>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </form>
      </div>
      <div class="extra-actions">
        <button nz-button nzType="danger" (click)="addTask()">新增任務</button>
        <a (click)="showTaskForm(false)">取消</a>
      </div>
    </div>
  </div>
</div>
<div class="task-container">
  <div class="task-todo">
    <nz-divider nzType="horizontal" [nzText]="todoTaskTpl" nzOrientation="left"></nz-divider>
    <nz-table [nzData]="listOfTodoTasks" [nzNoResult]="noResultTpl" [nzFrontPagination]="false" [nzShowPagination]="false" [nzWidthConfig]="tableWidthConfig">
      <tbody>
        <tr *ngFor="let task of listOfTodoTasks">
          <td
            nzShowCheckbox
            (nzCheckedChange)="checkTask(task)"
          ></td>
          <td>{{task.name}}</td>
          <td>
            <i class="more-actions" nz-icon nzType="ellipsis" nz-dropdown [nzDropdownMenu]="actions" nzPlacement="bottomRight" nzTrigger="click" (click)="setActivatedTask(task)"></i>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>
</div>

<nz-dropdown-menu #actions="nzDropdownMenu">
  <ul nz-menu>
    <li nz-menu-item (click)="showEditTask()">
      <i nz-icon nzType="edit" nzTheme="outline"></i> 編輯任務
    </li>
    <li nz-menu-divider></li>
    <li nz-menu-item (click)="deleteTask()">
      <i nz-icon nzType="delete" nzTheme="outline"></i> 刪除任務
    </li>
  </ul>
</nz-dropdown-menu>

<ng-template #noResultTpl>
  <nz-empty nzNotFoundContent="恭喜你完成了所有待辦任務！"></nz-empty>
</ng-template>

<ng-template #todoTaskTpl>
  <i nz-icon nzType="schedule" nzTheme="outline"></i> 待辦任務
</ng-template>

<nz-drawer
  [nzWidth]="400"
  [nzVisible]="visibleDetail"
  [nzPlacement]="'right'"
  [nzTitle]="activatedTask?.name"
  (nzOnClose)="cancelEdit()">
  <form nz-form [formGroup]="createForm">
    <nz-form-item>
      <nz-form-label nzSpan="6">
        名稱
      </nz-form-label>
      <nz-form-control nzSpan="17" nzErrorTip="請輸入任務名">
        <input nz-input formControlName="name" placeholder="請輸入任務名"/>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzSpan="6">
        描述
      </nz-form-label>
      <nz-form-control nzSpan="17">
        <input nz-input formControlName="description" placeholder="請輸入描述信息，可選填"/>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzSpan="6">
        目標時間
      </nz-form-label>
      <nz-form-control nzSpan="17">
        <nz-date-picker
          nzClassName="deadline-date-picker"
          formControlName="deadline"
          nzFormat="MMMMd日 HH:mm"
          [nzShowTime]="{ nzFormat: 'HH:mm' }"
          [nzDisabledDate]="disabledDate"
          nzPlaceHolder="請選擇目標完成時間"
        ></nz-date-picker>
      </nz-form-control>
    </nz-form-item>
  </form>
  <div class="buttons-group">
    <button nz-button nzType="danger" (click)="editTaskData()">修改任務</button>
    <button nz-button nzType="default" (click)="cancelEdit()">取消修改</button>
  </div>
</nz-drawer>
